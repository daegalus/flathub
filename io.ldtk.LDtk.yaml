app-id          : io.ldtk.LDtk
base            : org.electronjs.Electron2.BaseApp
base-version    : "22.08"
runtime         : org.freedesktop.Platform
runtime-version : "22.08"
sdk             : org.freedesktop.Sdk
command         : ldtk
separate-locales: false

finish-args:
  - --share=ipc
  - --socket=wayland
  - --socket=fallback-x11
  - --device=dri

modules:
    - name          : ldtk
      buildsystem   : simple
      build-commands:
          - chmod +x "LDtk 1.3.3 installer.AppImage"
          - ./"LDtk 1.3.3 installer.AppImage" --appimage-extract
          - rm "LDtk 1.3.3 installer.AppImage"
          - mv squashfs-root /app/ldtk
      post-install:
          # Install icons
          - install -Dm644
              /app/ldtk/usr/share/icons/hicolor/16x16/apps/ldtk.png
              /app/share/icons/hicolor/16x16/apps/$FLATPAK_ID.png
          - install -Dm644
              /app/ldtk/usr/share/icons/hicolor/32x32/apps/ldtk.png
              /app/share/icons/hicolor/32x32/apps/$FLATPAK_ID.png
          - install -Dm644
              /app/ldtk/usr/share/icons/hicolor/48x48/apps/ldtk.png
              /app/share/icons/hicolor/48x48/apps/$FLATPAK_ID.png
          - install -Dm644
              /app/ldtk/usr/share/icons/hicolor/64x64/apps/ldtk.png
              /app/share/icons/hicolor/64x64/apps/$FLATPAK_ID.png
          - install -Dm644
              /app/ldtk/usr/share/icons/hicolor/128x128/apps/ldtk.png
              /app/share/icons/hicolor/128x128/apps/$FLATPAK_ID.png
          - install -Dm644
              /app/ldtk/usr/share/icons/hicolor/256x256/apps/ldtk.png
              /app/share/icons/hicolor/256x256/apps/$FLATPAK_ID.png
          - install -Dm644
              /app/ldtk/usr/share/icons/hicolor/512x512/apps/ldtk.png
              /app/share/icons/hicolor/512x512/apps/$FLATPAK_ID.png

          - install -Dm644 /app/ldtk/ldtk.desktop /app/share/applications/$FLATPAK_ID.desktop
          - desktop-file-edit
             --set-icon $FLATPAK_ID
             --set-key Exec --set-value "ldtk %f" /app/share/applications/$FLATPAK_ID.desktop
          - install -Dm644 /app/ldtk/usr/share/mime/ldtk.xml /app/share/mime/packages/$FLATPAK_ID.xml
          - install -m755 ldtk-wrapper.sh /app/bin/ldtk

      sources:
          - type  : archive
            url   : "https://github.com/deepnight/ldtk/releases/download/v1.3.3/ubuntu-distribution.zip"
            sha512: "e34490b8207b69ff2495c6ca65450d42dc008c1743b565aae9f27eac8babb1d8a050364bafb3ca0d675d1f3eecc7d857db57f563c4bfd1f77c9edbab1cd0008b"
          - type: file
            path: ldtk-wrapper.sh
